import{_ as e,r as o,o as c,c as l,a as s,d as n,b as p,e as a}from"./app-8007fa1b.js";const i="/assets/tingshu051-8a9d8fb6.png",u="/assets/tingshu049-6876deb4.png",k={},r=a(`<h1 id="谷粒随享" tabindex="-1"><a class="header-anchor" href="#谷粒随享" aria-hidden="true">#</a> 谷粒随享</h1><p>点击添加声音的时候会触发一个查询所有专辑列表</p><p>http://127.0.0.1/api/album/albumInfo/findUserAllAlbumList 主要目的是为了让专辑与声音进行挂钩！</p><p>主要是根据userId查询数据{专辑Id，专辑标题}。然后并按照专辑Id 进行降序排列</p><h2 id="获取当前用户全部专辑列表" tabindex="-1"><a class="header-anchor" href="#获取当前用户全部专辑列表" aria-hidden="true">#</a> 获取当前用户全部专辑列表</h2><p>控制器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  * 获取当前用户专辑列表
  * <span class="token keyword">@return</span>
  */</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;获取当前用户全部专辑列表&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;findUserAllAlbumList&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">findUserAllAlbumList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//	调用服务层方法</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> albumInfoService<span class="token punctuation">.</span><span class="token function">findUserAllAlbumList</span><span class="token punctuation">(</span><span class="token class-name">AuthContextHolder</span><span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 获取当前用户专辑列表
* <span class="token keyword">@param</span> <span class="token parameter">userId</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserAllAlbumList</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserAllAlbumList</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 默认查看第一页</span>
   <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumInfo</span><span class="token punctuation">&gt;</span></span> albumInfoPage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 设置查询条件</span>
   <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumInfo</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   wrapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">AlbumInfo</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span><span class="token class-name">AlbumInfo</span><span class="token operator">::</span><span class="token function">getAlbumTitle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AlbumInfo</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">AlbumInfo</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 返回查询记录</span>
   <span class="token keyword">return</span> albumInfoMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>albumInfoPage<span class="token punctuation">,</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="上传声音" tabindex="-1"><a class="header-anchor" href="#上传声音" aria-hidden="true">#</a> 上传声音</h2><p>需要开通腾讯云服务 https://cloud.tencent.com/</p>`,13),d={href:"https://cloud.tencent.com/document/product/266/8757",target:"_blank",rel:"noopener noreferrer"},m=a(`<p>微信扫码登录：</p><p>关注公众号：</p><p>搜索云点播：</p><p>微信认证：</p><p>实名认证：</p><p>立即开通服务：</p><p>右边：点击访问管理</p><p>TrackInfoApiController 控制器中添加</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">TrackInfoService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>common<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>v3<span class="token punctuation">.</span>oas<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Operation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>v3<span class="token punctuation">.</span>oas<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>tags<span class="token punctuation">.</span></span><span class="token class-name">Tag</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Tag</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;声音管理&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/album/trackInfo&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrackInfoApiController</span> <span class="token punctuation">{</span>
	
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TrackInfoService</span> trackInfoService<span class="token punctuation">;</span>
  
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">VodService</span> vodService<span class="token punctuation">;</span>
	<span class="token doc-comment comment">/**
	 * 上传声音
	 * <span class="token keyword">@param</span> <span class="token parameter">file</span>
	 * <span class="token keyword">@return</span>
	 */</span>
	<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;上传声音&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;uploadTrack&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadTrack</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//	调用服务层方法</span>
		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> vodService<span class="token punctuation">.</span><span class="token function">uploadTrack</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VodService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 上传声音
     * <span class="token keyword">@param</span> <span class="token parameter">file</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadTrack</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),v={href:"https://cloud.tencent.com/document/product/266/10276",target:"_blank",rel:"noopener noreferrer"},b=a('<p>云API生成密钥：https://cloud.tencent.com/document/product/1278/85305</p><p>访问密钥：</p><p><img src="'+i+`" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">VodConstantProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">VodService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UploadFileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qcloud<span class="token punctuation">.</span>vod<span class="token punctuation">.</span></span><span class="token class-name">VodUploadClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qcloud<span class="token punctuation">.</span>vod<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">VodUploadRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qcloud<span class="token punctuation">.</span>vod<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">VodUploadResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">SneakyThrows</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VodServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">VodService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">VodConstantProperties</span> vodConstantProperties<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadTrack</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  声音上传临时目录：</span>
        <span class="token class-name">String</span> tempPath <span class="token operator">=</span> <span class="token class-name">UploadFileUtil</span><span class="token punctuation">.</span><span class="token function">uploadTempPath</span><span class="token punctuation">(</span>vodConstantProperties<span class="token punctuation">.</span><span class="token function">getTempPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  创建上传声音客户端</span>
        <span class="token class-name">VodUploadClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VodUploadClient</span><span class="token punctuation">(</span>vodConstantProperties<span class="token punctuation">.</span><span class="token function">getSecretId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vodConstantProperties<span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  构建上传请求对象</span>
        <span class="token class-name">VodUploadRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VodUploadRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  设置视频本地地址</span>
        request<span class="token punctuation">.</span><span class="token function">setMediaFilePath</span><span class="token punctuation">(</span>tempPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  指定任务流</span>
        request<span class="token punctuation">.</span><span class="token function">setProcedure</span><span class="token punctuation">(</span>vodConstantProperties<span class="token punctuation">.</span><span class="token function">getProcedure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  调用上传方法</span>
        <span class="token class-name">VodUploadResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>vodConstantProperties<span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  创建map 对象</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mediaFileId&quot;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mediaUrl&quot;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span><span class="token function">getMediaUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  返回map 数据</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),g={href:"https://console.cloud.tencent.com/vod/media",target:"_blank",rel:"noopener noreferrer"},f=a('<p><img src="'+u+`" alt=""></p><h2 id="保存声音" tabindex="-1"><a class="header-anchor" href="#保存声音" aria-hidden="true">#</a> 保存声音</h2><p>前端传递Json 字符串，此时我们可以使用封装好的TrackInfoVo实体类进行接收，方便处理数据</p><p>设计到的表有：</p><p>track_info 声音信息表</p><p>​ user_id : 直接从工具类中获取</p><p>​ order_num : 声音在专辑中的排序值，从1开始依次递增，值越小排序越前，根据专辑Id上一条声音的排序值 并且按照声音Id 进行降序排列 并且 获取第一条数.</p><p>​ media_duration , media_size ,media_type, media_url：根据流媒体Id获取到数据并赋值！获取到的数据使用TrackMediaInfoVo 对象接收</p><p>​ status : 自己设置</p><p>track_stat 声音统计表</p><p>​ 初始化： 播放量 收藏量 点赞数 评论数</p><p>album_info 专辑表</p><p>​ 因为修改专辑中的字段 include_track_count 专辑包含声音的总数</p><p>控制器，此时有还没有写用户登录相关代码，所以可以给用户Id 一个初始化数据 1</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  * 保存声音
  * <span class="token keyword">@param</span> <span class="token parameter">trackInfoVo</span>
  * <span class="token keyword">@return</span>
  */</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;新增声音&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;saveTrackInfo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">saveTrackInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Validated</span> <span class="token class-name">TrackInfoVo</span> trackInfoVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//	调用服务层方法</span>
  trackInfoService<span class="token punctuation">.</span><span class="token function">saveTrackInfo</span><span class="token punctuation">(</span>trackInfoVo<span class="token punctuation">,</span> <span class="token class-name">AuthContextHolder</span><span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 保存声音
* <span class="token keyword">@param</span> <span class="token parameter">trackInfoVo</span>
* <span class="token keyword">@param</span> <span class="token parameter">userId</span>
*/</span>
<span class="token keyword">void</span> <span class="token function">saveTrackInfo</span><span class="token punctuation">(</span><span class="token class-name">TrackInfoVo</span> trackInfoVo<span class="token punctuation">,</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveTrackInfo</span><span class="token punctuation">(</span><span class="token class-name">TrackInfoVo</span> trackInfoVo<span class="token punctuation">,</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 创建声音对象</span>
   <span class="token class-name">TrackInfo</span> trackInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 属性拷贝</span>
   <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>trackInfoVo<span class="token punctuation">,</span>trackInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
   trackInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">SystemConstant</span><span class="token punctuation">.</span><span class="token constant">TRACK_STATUS_PASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   trackInfo<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 获取上一条声音</span>
   <span class="token class-name">TrackInfo</span> preTrackInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">TrackInfo</span><span class="token operator">::</span><span class="token function">getAlbumId</span><span class="token punctuation">,</span> trackInfoVo<span class="token punctuation">.</span><span class="token function">getAlbumId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">TrackInfo</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">TrackInfo</span><span class="token operator">::</span><span class="token function">getOrderNum</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">&quot; limit 1 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> orderNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> preTrackInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      orderNum <span class="token operator">=</span> preTrackInfo<span class="token punctuation">.</span><span class="token function">getOrderNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// 获取流媒体信息.</span>
   <span class="token class-name">TrackMediaInfoVo</span> trackMediaInfo <span class="token operator">=</span> vodService<span class="token punctuation">.</span><span class="token function">getTrackMediaInfo</span><span class="token punctuation">(</span>trackInfoVo<span class="token punctuation">.</span><span class="token function">getMediaFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 赋值声音</span>
   trackInfo<span class="token punctuation">.</span><span class="token function">setMediaSize</span><span class="token punctuation">(</span>trackMediaInfo<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   trackInfo<span class="token punctuation">.</span><span class="token function">setMediaUrl</span><span class="token punctuation">(</span>trackMediaInfo<span class="token punctuation">.</span><span class="token function">getMediaUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   trackInfo<span class="token punctuation">.</span><span class="token function">setMediaDuration</span><span class="token punctuation">(</span>trackMediaInfo<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   trackInfo<span class="token punctuation">.</span><span class="token function">setMediaType</span><span class="token punctuation">(</span>trackMediaInfo<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
   trackInfo<span class="token punctuation">.</span><span class="token function">setOrderNum</span><span class="token punctuation">(</span>orderNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// 更新专辑声音总数</span>
   <span class="token class-name">AlbumInfo</span> albumInfo <span class="token operator">=</span> albumInfoService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getAlbumId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> includeTrackCount <span class="token operator">=</span> albumInfo<span class="token punctuation">.</span><span class="token function">getIncludeTrackCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   albumInfo<span class="token punctuation">.</span><span class="token function">setIncludeTrackCount</span><span class="token punctuation">(</span>includeTrackCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
   albumInfoService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>albumInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// 初始化统计数据</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveTrackStat</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">SystemConstant</span><span class="token punctuation">.</span><span class="token constant">TRACK_STAT_PLAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveTrackStat</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">SystemConstant</span><span class="token punctuation">.</span><span class="token constant">TRACK_STAT_COLLECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveTrackStat</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">SystemConstant</span><span class="token punctuation">.</span><span class="token constant">TRACK_STAT_PRAISE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveTrackStat</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">SystemConstant</span><span class="token punctuation">.</span><span class="token constant">TRACK_STAT_COMMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>初始化统计数据</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 初始化统计数量
* <span class="token keyword">@param</span> <span class="token parameter">trackId</span>
* <span class="token keyword">@param</span> <span class="token parameter">trackType</span>
*/</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveTrackStat</span><span class="token punctuation">(</span><span class="token class-name">Long</span> trackId<span class="token punctuation">,</span> <span class="token class-name">String</span> trackType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">TrackStat</span> trackStat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackStat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  trackStat<span class="token punctuation">.</span><span class="token function">setTrackId</span><span class="token punctuation">(</span>trackId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  trackStat<span class="token punctuation">.</span><span class="token function">setStatType</span><span class="token punctuation">(</span>trackType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  trackStat<span class="token punctuation">.</span><span class="token function">setStatNum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>trackStatMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>trackStat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21),I={href:"https://console.cloud.tencent.com/api/explorer?Product=vod&Version=2018-07-17&Action=DescribeMediaInfos",target:"_blank",rel:"noopener noreferrer"},y=a(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SneakyThrows</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">TrackMediaInfoVo</span> <span class="token function">getTrackMediaInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> mediaFileId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//  初始化认证对象</span>
  <span class="token class-name">Credential</span> cred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Credential</span><span class="token punctuation">(</span>vodConstantProperties<span class="token punctuation">.</span><span class="token function">getSecretId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vodConstantProperties<span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 实例化要请求产品的client对象,clientProfile是可选的</span>
  <span class="token class-name">VodClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VodClient</span><span class="token punctuation">(</span>cred<span class="token punctuation">,</span> vodConstantProperties<span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 实例化一个请求对象,每个接口都会对应一个request对象</span>
  <span class="token class-name">DescribeMediaInfosRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DescribeMediaInfosRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//  设置当前fileIds</span>
  req<span class="token punctuation">.</span><span class="token function">setFileIds</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>mediaFileId<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 返回的resp是一个DescribeMediaInfosResponse的实例，与请求对象对应</span>
  <span class="token class-name">DescribeMediaInfosResponse</span> response <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">client<span class="token punctuation">.</span></span>DescribeMediaInfos</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;声音详细返回结果：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//  判断对象不为空</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getMediaInfoSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//  获取到</span>
    <span class="token class-name">MediaInfo</span> mediaInfo <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getMediaInfoSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//  创建流媒体信息对象</span>
    <span class="token class-name">TrackMediaInfoVo</span> trackMediaInfoVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackMediaInfoVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span>mediaInfo<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>mediaInfo<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">setMediaUrl</span><span class="token punctuation">(</span>mediaInfo<span class="token punctuation">.</span><span class="token function">getBasicInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMediaUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span>mediaInfo<span class="token punctuation">.</span><span class="token function">getBasicInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//  返回数据</span>
    <span class="token keyword">return</span> trackMediaInfoVo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查询声音列表" tabindex="-1"><a class="header-anchor" href="#查询声音列表" aria-hidden="true">#</a> 查询声音列表</h2><p>需要根据用户Id，状态或标题查询当前声音列表！这三个条件被封装到一个实体类中 <strong>TrackInfoQuery</strong>,返回结果对象封装到 <strong>TrackListVo</strong> 实体类中</p><p>TrackInfoApiController 控制器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  * 查看声音专辑列表
  * <span class="token keyword">@param</span> <span class="token parameter">page</span>
  * <span class="token keyword">@param</span> <span class="token parameter">limit</span>
  * <span class="token keyword">@param</span> <span class="token parameter">trackInfoQuery</span>
  * <span class="token keyword">@return</span>
  
  */</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;获取当前用户声音分页列表&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;findUserTrackPage/{page}/{limit}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IPage</span><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserTrackPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Parameter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;当前页面&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                                                    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> page<span class="token punctuation">,</span>
                                                    <span class="token annotation punctuation">@Parameter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;limit&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;每页记录数&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                                                    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> limit<span class="token punctuation">,</span>
                                                    <span class="token annotation punctuation">@Parameter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;trackInfoQuery&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;查询对象&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                                                    <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">TrackInfoQuery</span> trackInfoQuery<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//	设置当前用户Id</span>
  trackInfoQuery<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token class-name">AuthContextHolder</span><span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//	创建对象</span>
  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> trackListVoPage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> trackListVoIPage <span class="token operator">=</span> trackInfoService<span class="token punctuation">.</span><span class="token function">findUserTrackPage</span><span class="token punctuation">(</span>trackListVoPage<span class="token punctuation">,</span>trackInfoQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//	返回数据</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>trackListVoIPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 查询声音专辑列表
* <span class="token keyword">@param</span> <span class="token parameter">trackListVoPage</span>
* <span class="token keyword">@param</span> <span class="token parameter">trackInfoQuery</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserTrackPage</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> trackListVoPage<span class="token punctuation">,</span> <span class="token class-name">TrackInfoQuery</span> trackInfoQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserTrackPage</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> trackListVoPage<span class="token punctuation">,</span> <span class="token class-name">TrackInfoQuery</span> trackInfoQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//	调用mapper层方法</span>
<span class="token keyword">return</span> trackInfoMapper<span class="token punctuation">.</span><span class="token function">selectUserTrackPage</span><span class="token punctuation">(</span>trackListVoPage<span class="token punctuation">,</span>trackInfoQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mapper接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>album<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>model<span class="token punctuation">.</span>album<span class="token punctuation">.</span></span><span class="token class-name">TrackInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>query<span class="token punctuation">.</span>album<span class="token punctuation">.</span></span><span class="token class-name">TrackInfoQuery</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>tingshu<span class="token punctuation">.</span>vo<span class="token punctuation">.</span>album<span class="token punctuation">.</span></span><span class="token class-name">TrackListVo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">IPage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>pagination<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TrackInfoMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackInfo</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>


    <span class="token doc-comment comment">/**
     * 查询声音专辑列表
     * <span class="token keyword">@param</span> <span class="token parameter">trackListVoPage</span>
     * <span class="token keyword">@param</span> <span class="token parameter">trackInfoQuery</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserTrackPage</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackListVo</span><span class="token punctuation">&gt;</span></span> trackListVoPage<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;vo&quot;</span><span class="token punctuation">)</span> <span class="token class-name">TrackInfoQuery</span> trackInfoQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TrackInfoMapper.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>
<span class="token name">PUBLIC</span> <span class="token string">&quot;-//ibatis.apache.org//DTD Mapper 3.0//EN&quot;</span>
<span class="token string">&quot;http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.tingshu.album.mapper.TrackInfoMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectUserTrackPage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.tingshu.vo.album.TrackListVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select
        any_value(info.albumId) as albumId,
        info.albumTitle,
        info.trackId,
        info.trackTitle,
        info.coverUrl,
        info.mediaDuration,
        info.status,
        info.createTime,
        MAX(IF(info.statType = &#39;0701&#39;, info.statNum, 0)) as playStatNum,
        MAX(IF(info.statType = &#39;0702&#39;, info.statNum, 0)) as collectStatNum,
        MAX(IF(info.statType = &#39;0703&#39;, info.statNum, 0)) as praiseStatNum,
        MAX(IF(info.statType = &#39;0704&#39;, info.statNum, 0)) as commentStatNum
        from (
        select
        album.id as albumId,
        album.album_title as albumTitle,
        track.id as trackId,
        track.track_title as trackTitle,
        track.media_duration as mediaDuration,
        if(track.cover_url is null or track.cover_url = &#39;&#39;, album.cover_url, track.cover_url) as coverUrl,
        track.status,
        track.create_time as createTime,
        stat.stat_type as statType,
        stat.stat_num as statNum
        from track_info track
        left join track_stat stat on stat.track_id = track.id
        left join album_info album on album.id = track.album_id
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vo.userId != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                and track.user_id = #{vo.userId}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vo.trackTitle != null and vo.trackTitle != &#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                and track.track_title like CONCAT(&#39;%&#39;,#{vo.trackTitle},&#39;%&#39;)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vo.status != null and vo.status != &#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                and track.status = #{vo.status}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            and track.is_deleted = 0
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
        ) info
        group by info.trackId
        order by info.trackId desc
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="修改声音" tabindex="-1"><a class="header-anchor" href="#修改声音" aria-hidden="true">#</a> 修改声音</h2><ol><li><p>根据Id获取数据并回显 将数据封装到 TrackInfo对象</p></li><li><p>保存修改之后的数据</p><p>​ 修改的时候，传递的有声音Id ，还有修改的Json 字符串.</p><p>​ 只修改track_info 表中的数据就可以了</p><p>​ 涉及到声音保存的问题，如果修改了声音，那么track_info 中声音信息，就需要修改media_duration , media_size ,media_type, media_url这些字段信息。</p><p>回显数据控制器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 根据Id 获取数据
* <span class="token keyword">@param</span> <span class="token parameter">id</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;获取声音信息&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;getTrackInfo/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTrackInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//	调用服务层方法</span>
  <span class="token class-name">TrackInfo</span> trackInfo <span class="token operator">=</span> trackInfoService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>保存修改控制器</p><p>传递声音Id ，封装好的TrackInfoVo 实体类。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 保存修改声音数据
* <span class="token keyword">@param</span> <span class="token parameter">id</span>
* <span class="token keyword">@param</span> <span class="token parameter">trackInfoVo</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;修改声音&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;updateTrackInfo/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">updateById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Validated</span> <span class="token class-name">TrackInfoVo</span> trackInfoVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//	调用服务层方法</span>
  trackInfoService<span class="token punctuation">.</span><span class="token function">updateTrackInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> trackInfoVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 保存数据
* <span class="token keyword">@param</span> <span class="token parameter">id</span>
* <span class="token keyword">@param</span> <span class="token parameter">trackInfoVo</span>
*/</span>
<span class="token keyword">void</span> <span class="token function">updateTrackInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">TrackInfoVo</span> trackInfoVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateTrackInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">TrackInfoVo</span> trackInfoVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//	获取到声音对象</span>
  <span class="token class-name">TrackInfo</span> trackInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//    获取传递的fileId</span>
  <span class="token class-name">String</span> mediaFileId <span class="token operator">=</span> trackInfo<span class="token punctuation">.</span><span class="token function">getMediaFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//	进行属性拷贝</span>
  <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>trackInfoVo<span class="token punctuation">,</span> trackInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//	获取声音信息 页面传递的fileId 与 数据库的 fileId 不相等就修改</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>trackInfoVo<span class="token punctuation">.</span><span class="token function">getMediaFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mediaFileId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//	说明已经修改过了.</span>
    <span class="token class-name">TrackMediaInfoVo</span> trackMediaInfoVo <span class="token operator">=</span> vodService<span class="token punctuation">.</span><span class="token function">getTrackMediaInfo</span><span class="token punctuation">(</span>trackInfoVo<span class="token punctuation">.</span><span class="token function">getMediaFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//	判断对象不为空.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">==</span>trackMediaInfoVo<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//	抛出异常</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuiguException</span><span class="token punctuation">(</span><span class="token class-name">ResultCodeEnum</span><span class="token punctuation">.</span><span class="token constant">VOD_FILE_ID_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    trackInfo<span class="token punctuation">.</span><span class="token function">setMediaUrl</span><span class="token punctuation">(</span>trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">getMediaUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackInfo<span class="token punctuation">.</span><span class="token function">setMediaType</span><span class="token punctuation">(</span>trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackInfo<span class="token punctuation">.</span><span class="token function">setMediaDuration</span><span class="token punctuation">(</span>trackMediaInfo<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    trackInfo<span class="token punctuation">.</span><span class="token function">setMediaSize</span><span class="token punctuation">(</span>trackMediaInfoVo<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//	修改数据</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="删除声音" tabindex="-1"><a class="header-anchor" href="#删除声音" aria-hidden="true">#</a> 删除声音</h2><p>设计的表： track_info，album_info，track_stat，media</p><p>思路：</p><pre><code>1.	track_info,track_stat：对这两张表要进行逻辑删除
2.	修改album_info 表中的专辑声音总数
3.	3.删除云点播中的声音记录
</code></pre><p>控制器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 删除声音
* <span class="token keyword">@param</span> <span class="token parameter">id</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;删除声音信息&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;removeTrackInfo/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">removeTrackInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//	调用服务层方法</span>
  trackInfoService<span class="token punctuation">.</span><span class="token function">removeTrackInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 删除声音
* <span class="token keyword">@param</span> <span class="token parameter">id</span>
*/</span>
<span class="token keyword">void</span> <span class="token function">removeTrackInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeTrackInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 获取声音对象数据</span>
   <span class="token class-name">TrackInfo</span> trackInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 删除</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//更新专辑声音总数</span>
   <span class="token class-name">AlbumInfo</span> albumInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>albumInfoService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getAlbumId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> includeTrackCount <span class="token operator">=</span> albumInfo<span class="token punctuation">.</span><span class="token function">getIncludeTrackCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   albumInfo<span class="token punctuation">.</span><span class="token function">setIncludeTrackCount</span><span class="token punctuation">(</span>includeTrackCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
   albumInfoService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>albumInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//删除统计数据</span>
   trackStatMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrackStat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">TrackStat</span><span class="token operator">::</span><span class="token function">getTrackId</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//删除声音媒体</span>
   vodService<span class="token punctuation">.</span><span class="token function">removeTrack</span><span class="token punctuation">(</span>trackInfo<span class="token punctuation">.</span><span class="token function">getMediaFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口与实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 根据媒体Id 删除数据
* <span class="token keyword">@param</span> <span class="token parameter">mediaFileId</span>
*/</span>
<span class="token keyword">void</span> <span class="token function">removeTrack</span><span class="token punctuation">(</span><span class="token class-name">String</span> mediaFileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,27),w={href:"https://console.cloud.tencent.com/api/explorer?Product=vod&Version=2018-07-17&Action=DeleteMedia",target:"_blank",rel:"noopener noreferrer"},T=a(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SneakyThrows</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeTrack</span><span class="token punctuation">(</span><span class="token class-name">String</span> mediaFileId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Credential</span> cred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Credential</span><span class="token punctuation">(</span>vodConstantProperties<span class="token punctuation">.</span><span class="token function">getSecretId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vodConstantProperties<span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 实例化要请求产品的client对象,clientProfile是可选的</span>
  <span class="token class-name">VodClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VodClient</span><span class="token punctuation">(</span>cred<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 实例化一个请求对象,每个接口都会对应一个request对象</span>
  <span class="token class-name">DeleteMediaRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteMediaRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span>mediaFileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 返回的resp是一个DeleteMediaResponse的实例，与请求对象对应</span>
  <span class="token class-name">DeleteMediaResponse</span> response <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">client<span class="token punctuation">.</span></span>DeleteMedia</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 输出json格式的字符串回包</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;声音删除返回结课: {}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function h(q,M){const t=o("ExternalLinkIcon");return c(),l("div",null,[r,s("p",null,[n("快速介入流程："),s("a",d,[n("云点播 快速入门-文档中心-腾讯云 (tencent.com)"),p(t)])]),m,s("p",null,[n("实现类 "),s("a",v,[n("云点播 Java SDK-开发指南-文档中心-腾讯云 (tencent.com)"),p(t)]),n(" Java 语言实现声音上传功能API")]),b,s("p",null,[n("上传之后可以在："),s("a",g,[n("音视频管理 - 媒资管理 - 云点播 - 控制台 (tencent.com)"),p(t)]),n("看是否有音频")]),f,s("p",null,[n("获取流媒体数据方法实现 参考地址"),s("a",I,[n("API Explorer - 云 API - 控制台 (tencent.com)"),p(t)])]),y,s("p",null,[s("a",w,[n("API Explorer - 云 API - 控制台 (tencent.com)"),p(t)])]),T])}const S=e(k,[["render",h],["__file","第2章 声音管理.html.vue"]]);export{S as default};
